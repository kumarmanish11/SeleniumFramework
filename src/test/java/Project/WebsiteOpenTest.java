package Project;

import org.testng.annotations.Test;

import java.io.File;
import java.io.IOException;

import org.apache.commons.io.FileUtils;
import org.openqa.selenium.By;
import org.openqa.selenium.OutputType;
import org.openqa.selenium.TakesScreenshot;

import org.testng.annotations.AfterTest;
import org.testng.annotations.DataProvider;


public class WebsiteOpenTest extends baseTest {
	// Extends to Inherit All the Basedriver Methods from baseTest

	@Test
	public void WebsiteToOpen() throws IOException {

		// Link and Window open
		driver.get("https://the-internet.herokuapp.com/");
		driver.manage().window().maximize();
		
		log.debug("The Browser has been passed the URL and the screen is maximized");

		// Clicking on the Form Link
		driver.findElement(By.xpath("//a[text()='Form Authentication']")).click();

	}

	@Test(dataProvider = "getData", dependsOnMethods = { "WebsiteToOpen" })
	public void loginAuth(String user, String password) throws IOException {

		// Sending the User Id and Password
		driver.findElement(By.xpath("//input[@id='username' and @type='text']")).sendKeys(user);
		driver.findElement(By.xpath("//input[@id='password' and @type='password']")).sendKeys(password);

		// Clicking on the Button
		driver.findElement(By.tagName("button")).click();

		// Get the Error Message if Present
		String err_text = "Your username is invalid!";
		String pass_text = "You logged into a secure area!";

		//When Id and Pwd Fails
		if (driver.findElement(By.xpath("//div[@id='flash']")).getText().trim().contains(err_text)) {
			System.out.println("Login Failure");
		}

		//When Id and Pwd Pass
		else if (driver.findElement(By.xpath("//div[@id='flash']")).getText().trim().contains(pass_text)) {
			System.out.println("Login Succes");
			System.out.println(driver.findElement(By.xpath("//h4[@class='subheader']")).getText());

			// Taking ScreenShot
			File Src = ((TakesScreenshot) driver).getScreenshotAs(OutputType.FILE);
			FileUtils.copyFile(Src,
					new File("C:\\Users\\Manish\\Desktop\\Selenium Learning\\Screenshots\\FrameWork_SS.png"));

			// Clicking on the Logout Button
			driver.findElement(By.xpath("//a[@href='/logout']")).click();
		}

	}

	@DataProvider
	public Object[][] getData() {

		// Declaring a Multi Dimensional Array
		Object data[][] = new Object[3][2];
		log.info("Multi Dimensional Array has been initialized");

		data[0][0] = "FirstUser";
		data[0][1] = "FirstPassword";

		data[1][0] = "tomsmith";
		data[1][1] = "SuperSecretPassword!";

		data[2][0] = "ThirdtUser";
		data[2][1] = "ThirdPassword";
		
		log.info("Multi Dimensional Array has been initialized and the data has been returned to repsective Method");
		return data;
		

	}

	@AfterTest
	public void WebSiteToClose() throws InterruptedException, IOException {

		// Close the Browser
		Thread.sleep(2000);
		driver.close();
		driver.quit();

		log.info("All the Steps have been Success");
	}

}
